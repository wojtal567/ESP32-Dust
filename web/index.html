<!DOCTYPE html>
<html>
 
    <head>
        <script src="src/jquery-3.3.1.min.js"></script>
        <script src="src/bootstrap.bundle.min.js"></script>
            <link rel="stylesheet" type="text/css" href="src/bootstrap.min.css">
    </head>
 
    <body>
        <div class="jumbotron jumbotron-fluid">
            <div class="container">
                <h1 class="display-4" id="timestamp" >Tech Tutorials X</h1>
                <p class="lead" id="lastSampleBox">Testing Bootstrap.</p>
            </div>
        </div>
    </body>
    <script>
        setInterval(function() {
            getYear();
        }, 1000);
        function getYear() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if(this.readyState===4 && this.status === 200) {
                    document.getElementById("timestamp").innerHTML = this.responseText;
                }
            };
            xhttp.open("GET", "/timestamp", true);
            xhttp.send();
        }

        var gateway = `ws://${window.location.hostname}/ws`;
        var websocket;
        function initWebSocket() {
            console.log('Trying to open a WebSocket connection...');
            websocket = new WebSocket(gateway);
            websocket.onopen    = onOpen;
            websocket.onclose   = onClose;
            websocket.onmessage = onMessage; // <-- add this line
        }
        function onOpen(event) {
            console.log('Connection opened');
        }

        function onClose(event) {
            console.log('Connection closed');
            setTimeout(initWebSocket, 2000);
        }
        function onMessage(event) {
            console.log(event.data);
            var lastSample = JSON.parse(event.data);
            document.getElementById('lastSampleBox').innerHTML = JSON.stringify(lastSample,null, 4);
        }

        window.addEventListener('load', onLoad);

        function onLoad(event) {
            initWebSocket();
            getYear();
        }
    </script>
</html>